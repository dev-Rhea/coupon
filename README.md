# coupon payment system

📋 프로젝트 개요

쿠폰 결제 시스템은 대용량 트래픽과 높은 동시성을 처리할 수 있는 결제 플랫폼

🛠️ 기술 스택
#### Backend Framework

Spring Boot 3.2: 메인 애플리케이션 프레임워크
Spring Security: 인증/인가 처리
Spring Data JPA: ORM 및 데이터 접근 계층
Spring Batch: 대용량 배치 처리

#### Business Process Management

Camunda BPM 7.20: 워크플로우 엔진 및 프로세스 오케스트레이션
BPMN 2.0: 비즈니스 프로세스 모델링

#### Database & Cache

MySQL 8.0: 메인 데이터베이스 (트랜잭션 데이터)
Redis 7.0: 캐시 및 세션 스토어
Redisson: Redis 기반 분산 락 구현

#### Monitoring & Logging

SLF4J + Logback: 구조화된 로깅
Micrometer: 메트릭 수집 및 모니터링
Spring Actuator: 헬스체크 및 운영 정보

## 📊 시스템 아키텍처 다이어그램

```

┌─ PRESENTATION LAYER ────────────────────────────────────────────────────────┐
│                                                                             │
│  ┌───────────────┐    ┌───────────────┐    ┌───────────────┐               │
│  │   Frontend    │    │  API Gateway  │    │ Load Balancer │               │
│  │ (Mobile/Web)  │───▶│ (Spring MVC)  │───▶│    (Nginx)    │               │
│  └───────────────┘    └───────────────┘    └───────────────┘               │
│                              │                      │                       │
└──────────────────────────────┼──────────────────────┼───────────────────────┘
                               │                      │
                               ▼                      ▼
┌─ SERVICE LAYER ─────────────────────────────────────────────────────────────┐
│                               │                      │                       │
│  ┌───────────────┐           ┌┴──────────────┐     ┌┴───────────────┐       │
│  │ Coupon Service│◄──────────┤Payment Service├────▶│Settlement      │       │
│  │  (Core BL)    │           │ (Camunda BPM) │     │Service         │       │
│  └───────┬───────┘           └───────┬───────┘     └┬───────────────┘       │
│          │                           │              │                       │
└──────────┼───────────────────────────┼──────────────┼───────────────────────┘
           │                           │              │
           ▼                           ▼              ▼
┌─ DATA LAYER ────────────────────────────────────────────────────────────────┐
│          │                           │              │                       │
│  ┌───────▼───────┐           ┌───────▼───────┐     ┌▼───────────────┐       │
│  │ Redis Cluster │           │   MySQL 8.0   │     │  Spring Batch  │       │
│  │(Cache/Session)│           │ (Transaction)  │     │  (Scheduling)  │       │
│  └───────────────┘           └───────────────┘     └────────────────┘       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

================================================================================
```

## 🔄 데이터 플로우

```
📱 Client Request
    │
    ▼
🚪 API Gateway (인증/인가/라우팅)
    │
    ▼
⚖️  Load Balancer (부하 분산)
    │
    ├─────────────────┬─────────────────┐
    ▼                 ▼                 ▼
🎫 Coupon         💳 Payment        💰 Settlement
   Service           Service           Service
    │                 │                 │
    │        ┌────────┴────────┐        │
    │        │                 │        │
    ▼        ▼                 ▼        ▼
🔥 Redis   🗃️ MySQL 8.0      ⚙️ Spring Batch
```

## 🏗️ 컴포넌트 상세 정보

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            📋 COMPONENT DETAILS                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ 🎫 COUPON SERVICE                                                           │
│ ├─ 쿠폰 검증 및 잔액 관리                                                     │
│ ├─ Redis 분산 락 (동시성 제어)                                               │
│ ├─ 실시간 잔액 예약/확정/복원                                                │
│ └─ REST API: /api/coupons/**                                               │
│                                                                             │
│ 💳 PAYMENT SERVICE                                                          │
│ ├─ Camunda BPM 워크플로우 엔진                                               │
│ ├─ PG사 연동 및 결제 처리                                                    │
│ ├─ 보상 트랜잭션 (Saga Pattern)                                             │
│ └─ REST API: /api/payments/**                                              │
│                                                                             │
│ 💰 SETTLEMENT SERVICE                                                       │
│ ├─ 가맹점별 정산 처리                                                        │
│ ├─ Spring Batch 일괄 처리                                                   │
│ ├─ 정산 리포트 생성                                                          │
│ └─ REST API: /api/settlements/**                                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 🛠️ 기술 스택 매트릭스

```
┌─────────────────┬─────────────────┬─────────────────┬─────────────────┐
│   COMPONENT     │   FRAMEWORK     │   DATABASE      │   FEATURES      │
├─────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ 🎫 Coupon       │ Spring Boot 3.2 │ Redis Cluster   │ 분산 락         │
│   Service       │ Spring Data JPA │ MySQL 8.0       │ 실시간 캐싱      │
├─────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ 💳 Payment      │ Camunda BPM 7.2│ MySQL 8.0       │ 워크플로우       │
│   Service       │ Spring Boot 3.2 │ Redis Session   │ 보상 트랜잭션    │
├─────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ 💰 Settlement   │ Spring Batch    │ MySQL 8.0       │ 배치 처리       │
│   Service       │ Spring Boot 3.2 │ -               │ 스케줄링        │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
```


## 🔄 비즈니스 프로세스 플로우

```
결제 처리 워크플로우 (Camunda BPM)
═══════════════════════════════════════════════════════════════════════════════

┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ 결제요청 │───▶│쿠폰검증  │───▶│PG 결제  │───▶│쿠폰확정  │───▶│완료처리  │
└─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
     │              │              │              │              │
     ▼              ▼              ▼              ▼              ▼
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│입력검증  │    │잔액예약  │    │PG 승인  │    │사용확정  │    │정산생성  │
│사용자확인│    │유효성체크│    │결제처리  │    │잔액차감  │    │알림발송  │
└─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
     │              │              │              │              │
     ▼              ▼              ▼              ▼              ▼
   SUCCESS        SUCCESS        SUCCESS        SUCCESS        SUCCESS
     │              │              │              │              │
   FAILED ─────────▼│────────────▼│────────────▼│────────────▼│
                    │              │              │              │
                ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
                │잔액복원  │    │PG 취소  │    │보상처리  │    │실패처리  │
                └─────────┘    └─────────┘    └─────────┘    └─────────┘

═══════════════════════════════════════════════════════════════════════════════
```




📦 모듈 구성

핵심 기능


🎫 coupon-core - 쿠폰 관리 핵심 모듈


✅ 쿠폰 검증 로직: 유효기간, 잔액, 가맹점 제한 등 종합 검증



✅ 실시간 잔액 관리: Redis 기반 고성능 잔액 캐싱 및 동시성 제어



✅ 분산 락 메커니즘: Redisson을 활용한 안전한 쿠폰 상태 관리



✅ 예약 시스템: 결제 진행 중 잔액 임시 예약으로 이중 사용 방지





💳 coupon-payment - 결제 처리 모듈

✅ Camunda BPM 워크플로우: 결제 전체 생명주기 관리



✅ PG사 연동: Mock PG 서비스를 통한 실제적인 결제 시뮬레이션



✅ 보상 트랜잭션: 각 단계 실패 시 자동 롤백 처리



✅ 비동기 처리: 알림, 로깅 등 부가 작업의 논블로킹 처리





[쿠폰 검증] → [PG 결제] → [쿠폰 확정] → [완료 처리]
↓            ↓           ↓            ↓
[잔액 복원]   [결제 취소]  [PG 취소]   [실패 처리]







💰 coupon-settlement - 정산 관리 모듈



✅ 자동 정산 처리: Spring Batch 기반 일간/월간 정산 배치



✅ 실시간 조정: 결제 취소/환불 시 즉시 정산 조정



✅ 정합성 검증: 거래 데이터와 정산 데이터 일치성 검증



✅ 리포트 생성: 가맹점별 상세 정산 리포트 제공




<<<<<<< HEAD


=======
# 🎫 케이뱅크 민생 쿠폰 결제 시스템
> **Enterprise-Grade Coupon Payment System** | Spring Boot + Camunda BPM + Redis

[![Java](https://img.shields.io/badge/Java-17-orange.svg)](https://openjdk.java.net/projects/jdk/17/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2-brightgreen.svg)](https://spring.io/projects/spring-boot)
[![Camunda](https://img.shields.io/badge/Camunda-7.20-blue.svg)](https://camunda.com/)
[![Redis](https://img.shields.io/badge/Redis-7.0-red.svg)](https://redis.io/)
[![MySQL](https://img.shields.io/badge/MySQL-8.0-blue.svg)](https://www.mysql.com/)

## 📋 프로젝트 개요

케이뱅크의 **민생 쿠폰 결제 시스템**은 대용량 트래픽과 높은 동시성을 처리할 수 있는 엔터프라이즈급 결제 플랫폼입니다.
쿠폰 관리부터 결제 처리, 정산까지 전체 생명주기를 안전하고 효율적으로 관리합니다.

### 🎯 주요 특징
- **🔒 높은 안정성**: 분산 락과 보상 트랜잭션을 통한 데이터 무결성 보장
- **⚡ 고성능**: Redis 캐싱과 비동기 처리로 빠른 응답속도 구현
- **🔄 BPM 기반**: Camunda를 활용한 복잡한 비즈니스 프로세스 오케스트레이션
- **📊 실시간 모니터링**: 상세한 로깅과 메트릭 수집으로 운영 가시성 확보
- **🛡️ 장애 대응**: Circuit Breaker와 Retry 메커니즘으로 장애 복구력 강화

---

## 🏗️ 시스템 아키텍처

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   API Gateway   │    │   Load Balance  │
│   (Mobile/Web)  │───▶│   (Spring MVC)  │───▶│   (Nginx)       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
                       ┌────────────────────────────────┼────────────────────────────────┐
                       │                                │                                │
            ┌─────────────────┐              ┌─────────────────┐              ┌─────────────────┐
            │ Coupon Service  │              │ Payment Service │              │Settlement Service│
            │   (Core BL)     │◀────────────▶│  (Camunda BPM) │◀────────────▶│  (Batch Job)    │
            └─────────────────┘              └─────────────────┘              └─────────────────┘
                       │                                │                                │
            ┌─────────────────┐              ┌─────────────────┐              ┌─────────────────┐
            │ Redis Cluster   │              │   MySQL 8.0    │              │  Spring Batch   │
            │ (Cache/Session) │              │  (Transaction)  │              │  (Scheduling)   │
            └─────────────────┘              └─────────────────┘              └─────────────────┘
```

---

## 📦 모듈 구성

### 🎫 `coupon-core` - 쿠폰 관리 핵심 모듈
**핵심 기능**
- ✅ **쿠폰 검증 로직**: 유효기간, 잔액, 가맹점 제한 등 종합 검증
- ✅ **실시간 잔액 관리**: Redis 기반 고성능 잔액 캐싱 및 동시성 제어
- ✅ **분산 락 메커니즘**: Redisson을 활용한 안전한 쿠폰 상태 관리
- ✅ **예약 시스템**: 결제 진행 중 잔액 임시 예약으로 이중 사용 방지


### 💳 `coupon-payment` - 결제 처리 모듈
**핵심 기능**
- ✅ **Camunda BPM 워크플로우**: 결제 전체 생명주기 관리
- ✅ **PG사 연동**: Mock PG 서비스를 통한 실제적인 결제 시뮬레이션
- ✅ **보상 트랜잭션**: 각 단계 실패 시 자동 롤백 처리
- ✅ **비동기 처리**: 알림, 로깅 등 부가 작업의 논블로킹 처리

**워크플로우 단계**
```
[쿠폰 검증] → [PG 결제] → [쿠폰 확정] → [완료 처리]
     ↓            ↓           ↓            ↓
[잔액 복원]   [결제 취소]  [PG 취소]   [실패 처리]
```

### 💰 `coupon-settlement` - 정산 관리 모듈
**핵심 기능**
- ✅ **자동 정산 처리**: Spring Batch 기반 일간/월간 정산 배치
- ✅ **실시간 조정**: 결제 취소/환불 시 즉시 정산 조정
- ✅ **정합성 검증**: 거래 데이터와 정산 데이터 일치성 검증
- ✅ **리포트 생성**: 가맹점별 상세 정산 리포트 제공

>>>>>>> 334fbb1 (readme)
